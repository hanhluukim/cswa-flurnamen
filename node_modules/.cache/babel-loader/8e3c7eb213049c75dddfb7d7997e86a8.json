{"ast":null,"code":"import axios from \"axios\"; //Infornation von APIs\n\nconst token = \"cmVzdGFwaS1yZWFkOmRlMjgxMjMyOGIzYTZmODc1NDIyYjM4NzZlMDJiZTM3\";\nconst authHeader = {\n  'Authorization': `Basic ${token}`\n};\nconst API_URL = 'https://collections.thulb.uni-jena.de/api/v1';\nconst keys = ['title', 'area', 'evidence', 'note', 'parent'];\n/*\nAus der Daten werden nur folgende Funktionen eines Ergebnises gespeichert.\n*/\n\nconst getImage = async objectID => {\n  var imgReq = \"https://collections.thulb.uni-jena.de/api/v1/objects/\" + objectID;\n  var imgL = [];\n  await axios.get(imgReq, {\n    headers: authHeader\n  }).then(response => {\n    var xml2js = require('react-native-xml2js');\n\n    var parser = new xml2js.Parser();\n    var dataJS = '';\n    parser.parseString(response.data, function (err, detailJSON) {\n      dataJS = detailJSON.mycoreobject;\n    });\n\n    try {\n      imgL = dataJS.structure[0].derobjects[0].derobject;\n    } catch {}\n  });\n  console.log(\"test image\");\n  console.log(imgL);\n  return imgL;\n};\n\nasync function getResultsList(data) {\n  const foundObjects = [];\n\n  for (var i = 0; i < data.length; i++) {\n    var len = 0;\n\n    if (data[i]['link'] != null) {\n      len = data[i]['link'].length;\n    }\n\n    var new_data = {\n      'id': data[i]['id'],\n      'title': data[i]['title'][0],\n      'place': data[i]['place'][0],\n      'gnd': data[i]['gnd'],\n      'link': data[i]['link'],\n      'len': len,\n      'facetObjectType': data[i]['facetObjectType'],\n      \"search_result_link_text\": data[i][\"search_result_link_text\"],\n      'ArchFile_class_001_Label': data[i]['ArchFile_class_001_Label'][1],\n      'img': ''\n    };\n    var objectID = new_data['id'];\n    var imgL = [];\n    imgL = await getImage(objectID);\n    /*.then(function (res){\n      console.log(\"in function get imageeee\");\n      \n      imgL = res;\n      console.log(imgL);\n      \n    });\n    */\n\n    if (imgL.length != 0) {\n      console.log(\"outside of function\");\n      console.log(imgL[0]); //.$[\"xlink:href\"]\n      //https://collections.thulb.uni-jena.de/rsc/viewer/HisBest_derivate_00024139/Flurnamen_Erfurt_Arnstadt_4605.tif\n\n      var VIEW_URL = 'https://collections.thulb.uni-jena.de/servlets/MCRTileCombineServlet/MID/';\n      var TIF = imgL[0].maindoc[0];\n      new_data['img'] = VIEW_URL + imgL[0].$[\"xlink:href\"] + \"/\" + TIF;\n    }\n\n    console.log(\"adding to new data\");\n    console.log(new_data.img);\n    foundObjects.push(new_data);\n  }\n\n  return foundObjects;\n}\n\n;\n/*\nFunktion zum Aufrufen der Daten mit dem gegebenen Title.\nReturn bereits in JSON\nErgebnisse für gesuchten Title werden an Search Komponent gesendet\n*/\n\nconst searchInfoQuery = (title, filter) => {\n  console.log(\"search option: \" + filter);\n\n  if (filter == \"0\") {\n    var req = API_URL + '/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND title:' + title;\n    return axios.get(req, {\n      headers: authHeader\n    }).then(response => {\n      const data = response.data.response.docs; //docs is a list\n\n      const resp_in_list = getResultsList(data);\n      return resp_in_list;\n    });\n  }\n\n  if (filter == \"1\") {\n    var req_flurname = API_URL + '/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND objectType:\"cbu\" AND facetObjectType:\"Flurkarte\" AND title:' + title;\n    return axios.get(req_flurname, {\n      headers: authHeader\n    }).then(response => {\n      const data = response.data.response.docs; //docs is a list\n\n      const resp_in_list = getResultsList(data);\n      return resp_in_list;\n    });\n  }\n\n  if (filter == \"2\") {\n    var req_gemarkung = API_URL + '/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND objectType:\"cbu\" AND facetObjectType:\"Gemarkung\" AND title:' + title;\n    return axios.get(req_gemarkung, {\n      headers: authHeader\n    }).then(response => {\n      const data = response.data.response.docs; //docs is a list\n\n      const resp_in_list = getResultsList(data);\n      return resp_in_list;\n    });\n  }\n\n  if (filter == \"3\") {\n    //https://collections.thulb.uni-jena.de/api/v1/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND place_extended_search:\"Jena\"\n    var req_place = API_URL + '/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND objectType:\"cbu\" AND place_extended_search:' + title;\n    return axios.get(req_place, {\n      headers: authHeader\n    }).then(response => {\n      const data = response.data.response.docs; //docs is a list\n\n      const resp_in_list = getResultsList(data);\n      return resp_in_list;\n    });\n  }\n};\n/*\n- Eine Gemarkung hat eine Sammlung von untergeordneten Flurnamen als children\n- Es gibt eine Liste der children der Gemarkung\n- Für jedes Element (flurname) wird ein GET-Request mit ID gesendet\n- Nur einige Merkmale wurden gespeichert\n*/\n\n\nconst getChilden = async childList => {\n  //console.log(\"RUFEN CHILDREN\");\n  var childInfos = [];\n  /*\n  var childImgs=[];\n  for(var i in childList.slice(0,15)){\n    var childID = childList[i].$[\"xlink:title\"];\n    var imgReq = API_URL+'/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND returnId:'+childID;\n    await axios.get(imgReq,{headers:authHeader}).then(function (response){\n      var data = response.data.response.docs;\n     }\n  };\n  */\n\n  for (var i in childList.slice(0, 5)) {\n    var childID = childList[i].$[\"xlink:title\"];\n    var childReq = API_URL + '/objects/' + childID;\n    var childRes = {}; //get Images\n\n    await axios.get(childReq, {\n      headers: authHeader\n    }).then(function (response) {\n      var xml2js = require('react-native-xml2js');\n\n      var parser = new xml2js.Parser();\n      var dataJS = '';\n      parser.parseString(response.data, function (err, detailJSON) {\n        dataJS = detailJSON.mycoreobject; //console.log(\"content\");\n        //console.log(content);\n        //dataJS = content;\n      });\n      var content = {\n        title: ' ',\n        area: ' ',\n        evidence: ' ',\n        note: ' ',\n        parent: ' '\n      };\n\n      try {\n        //metadata[0][\"def.title\"][0].title[0]._\n        var title = dataJS.metadata[0][\"def.title\"][0].title[0]._;\n        content.title = title;\n      } catch {}\n\n      try {\n        var area = dataJS.metadata[0][\"def.area\"][0].area[0]._;\n        content.area = area;\n      } catch {}\n\n      try {\n        var evidence = dataJS.metadata[0][\"def.evidence\"][0].evidence[0]._;\n        content.evidence = evidence;\n      } catch {}\n\n      try {\n        var note = dataJS.metadata[0][\"def.note\"][0].note[0]._;\n        content.note = note;\n      } catch {}\n\n      try {\n        var parent = dataJS.structure[0].parents[0].parent[0].$[\"xlink:href\"];\n        content.parent = parent;\n      } catch {} //return resJ;\n      //console.log('content');\n      //console.log(content);\n\n\n      childRes = content; //console.log('chilRes in function');\n      //console.log(childRes);\n    });\n    console.log(\"children\");\n    console.log(childRes);\n    childInfos.push(childRes);\n  }\n\n  return childInfos;\n};\n/*\nresponse von einer Gemarkung beinhaltet mehrere children\ninformation von children wird mit der funktion getChildren gefunden und gespeichert\n*/\n\n\nconst contentDetailGemarkung = async dataJS => {\n  console.log(\"JSONJSON\");\n  console.log(dataJS);\n  var content = {\n    'title': dataJS.metadata[0][\"def.title\"][0].title[0][\"_\"],\n    //structure[0].derobjects[0].derobject[0].maindoc[0]\n    //'img':dataJS.structure[0].derobjects[0].derobject[0].maindoc[0],\n    'img': [],\n    'children': []\n  };\n\n  try {\n    content.img = dataJS.structure[0].derobjects[0].derobject; //[0].maindoc[0]\n  } catch {}\n\n  console.log(\"IMAGE\");\n  console.log(content.img);\n  var childINfos = null;\n  await getChilden(dataJS.structure[0].children[0].child).then(function (result) {\n    console.log(result);\n    childINfos = result;\n  });\n  content.children = childINfos;\n  var result = [];\n  result.push(childINfos);\n  return result;\n};\n/*\nInformationen eines Flurnamen wird gefiltert und gespeichert\n\n*/\n\n\nconst contentDetailFlurname = dataJS => {\n  //console.log(dataJS);\n  //console.log(\"SERVER RESPONSE\");\n  const details = [[]];\n  const content = {\n    title: ' ',\n    area: ' ',\n    evidence: ' ',\n    note: ' ',\n    parent: ' ',\n    img: []\n  };\n\n  try {\n    //metadata[0][\"def.title\"][0].title[0]._\n    var title = dataJS.metadata[0][\"def.title\"][0].title[0]._;\n    content.title = title;\n  } catch {}\n\n  try {\n    var area = dataJS.metadata[0][\"def.area\"][0].area[0]._;\n    content.area = area;\n  } catch {}\n\n  try {\n    var evidence = dataJS.metadata[0][\"def.evidence\"][0].evidence[0]._;\n    content.evidence = evidence;\n  } catch {}\n\n  try {\n    var note = dataJS.metadata[0][\"def.note\"][0].note[0]._;\n    content.note = note;\n  } catch {}\n\n  try {\n    var parent = dataJS.structure[0].parents[0].parent[0].$[\"xlink:href\"];\n    content.parent = parent;\n  } catch {}\n\n  try {\n    content.img = dataJS.structure[0].derobjects[0].derobject; //[0].maindoc[0]\n  } catch {}\n\n  console.log(\"IMAGE\");\n  console.log(content.img);\n  details[0].push(content);\n  return details;\n};\n\nconst getInfoDetails = objectID => {\n  var req = API_URL + '/objects/' + objectID;\n  return axios.get(req, {\n    headers: authHeader\n  }).then(response => {\n    var xml2js = require('react-native-xml2js');\n\n    var parser = new xml2js.Parser();\n    var dataJS = '';\n    parser.parseString(response.data, function (err, detailJSON) {\n      dataJS = detailJSON.mycoreobject;\n    }); //console.log(\"ALL KEYS\");\n    //console.log(dataJS);\n    //console.log(Object.keys(dataJS.structure));\n    //console.log(dataJS.structure['0']);\n\n    var keys = Object.keys(dataJS.structure['0']);\n\n    if (keys.includes('children')) {\n      var contentG = contentDetailGemarkung(dataJS); //console.log(\"RUECKWERTE\");\n      //console.log(contentG);\n\n      return contentG;\n    } else {\n      //Flurname\n      var contentF = contentDetailFlurname(dataJS);\n      return contentF;\n    } //console.log(dataJS);\n    //var content = contentDetails(dataJS)\n\n  });\n};\n\nexport default {\n  searchInfoQuery,\n  getInfoDetails\n};","map":{"version":3,"sources":["/home/miss-luu/Downloads/0_Studium/0_web_client/cswa-flurnamen/react-flurnamen/src/components/apis/get.service.js"],"names":["axios","token","authHeader","API_URL","keys","getImage","objectID","imgReq","imgL","get","headers","then","response","xml2js","require","parser","Parser","dataJS","parseString","data","err","detailJSON","mycoreobject","structure","derobjects","derobject","console","log","getResultsList","foundObjects","i","length","len","new_data","VIEW_URL","TIF","maindoc","$","img","push","searchInfoQuery","title","filter","req","docs","resp_in_list","req_flurname","req_gemarkung","req_place","getChilden","childList","childInfos","slice","childID","childReq","childRes","content","area","evidence","note","parent","metadata","_","parents","contentDetailGemarkung","childINfos","children","child","result","contentDetailFlurname","details","getInfoDetails","Object","includes","contentG","contentF"],"mappings":"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","sourcesContent":["import axios from \"axios\";\n\n//Infornation von APIs\nconst token=\"cmVzdGFwaS1yZWFkOmRlMjgxMjMyOGIzYTZmODc1NDIyYjM4NzZlMDJiZTM3\"\nconst authHeader={'Authorization': `Basic ${token}`}\nconst API_URL='https://collections.thulb.uni-jena.de/api/v1'\n\n\nconst keys=[\n  'title',\n  'area',\n  'evidence',\n  'note',\n  'parent'\n]\n/*\nAus der Daten werden nur folgende Funktionen eines Ergebnises gespeichert.\n*/\nconst getImage = async (objectID) =>{\n  var imgReq = \"https://collections.thulb.uni-jena.de/api/v1/objects/\"+objectID;\n  var imgL=[];\n  await axios.get(imgReq, {headers:authHeader}).then((response)=>{\n          \n      var xml2js = require('react-native-xml2js');\n      var parser = new xml2js.Parser();\n      var dataJS='';\n      parser.parseString(response.data, function (err, detailJSON) {\n          dataJS = detailJSON.mycoreobject;\n      });\n      \n      try{\n      imgL = dataJS.structure[0].derobjects[0].derobject;\n      }catch{}\n\n      \n      \n  });\n  console.log(\"test image\");\n  console.log(imgL);\n  return imgL;\n};\n\nasync function getResultsList(data){\n\n  const foundObjects=[]\n  for (var i = 0; i < data.length; i++)\n        {\n            var len=0\n            if(data[i]['link']!=null){\n              len=data[i]['link'].length\n            }\n            var new_data={\n                'id':data[i]['id'],\n                'title':data[i]['title'][0],\n                'place':data[i]['place'][0],\n                'gnd':data[i]['gnd'],\n                'link':data[i]['link'],\n                'len':len,\n                'facetObjectType':data[i]['facetObjectType'],\n                \"search_result_link_text\":data[i][\"search_result_link_text\"],\n                'ArchFile_class_001_Label':data[i]['ArchFile_class_001_Label'][1],\n                'img':''\n                \n            }\n            var objectID = new_data['id'];\n            var imgL = []\n            \n            imgL = await getImage(objectID);\n            /*.then(function (res){\n              console.log(\"in function get imageeee\");\n              \n              imgL = res;\n              console.log(imgL);\n              \n            });\n            */\n            if(imgL.length!=0){\n            console.log(\"outside of function\");\n            console.log(imgL[0]);\n            //.$[\"xlink:href\"]\n            //https://collections.thulb.uni-jena.de/rsc/viewer/HisBest_derivate_00024139/Flurnamen_Erfurt_Arnstadt_4605.tif\n            var VIEW_URL = 'https://collections.thulb.uni-jena.de/servlets/MCRTileCombineServlet/MID/';\n            var TIF = imgL[0].maindoc[0];\n            new_data['img'] = VIEW_URL+imgL[0].$[\"xlink:href\"]+\"/\"+TIF;\n            }\n            console.log(\"adding to new data\");\n            console.log(new_data.img);\n\n            foundObjects.push(new_data)\n        }\n    return foundObjects\n};\n\n\n/*\nFunktion zum Aufrufen der Daten mit dem gegebenen Title.\nReturn bereits in JSON\nErgebnisse für gesuchten Title werden an Search Komponent gesendet\n*/\nconst searchInfoQuery  = (title, filter) => {\n  console.log(\"search option: \" + filter);\n    if(filter==\"0\"){\n      var req = API_URL+ '/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND title:'+title;\n      return axios.get(req, {headers:authHeader}).then((response)=>{\n        \n          const data = response.data.response.docs; //docs is a list\n          const resp_in_list= getResultsList(data);\n          return resp_in_list;\n      });    \n    }   \n    if(filter==\"1\"){\n      var req_flurname = API_URL+ '/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND objectType:\"cbu\" AND facetObjectType:\"Flurkarte\" AND title:'+title;\n      return axios.get(req_flurname, {headers:authHeader}).then((response)=>{\n        \n          const data = response.data.response.docs; //docs is a list\n          const resp_in_list= getResultsList(data);\n          return resp_in_list;\n      });    \n    }\n    if(filter==\"2\"){\n      var req_gemarkung = API_URL+ '/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND objectType:\"cbu\" AND facetObjectType:\"Gemarkung\" AND title:'+title;\n      return axios.get(req_gemarkung, {headers:authHeader}).then((response)=>{\n        \n          const data = response.data.response.docs; //docs is a list\n          const resp_in_list= getResultsList(data);\n          return resp_in_list;\n      });    \n    }\n    if(filter==\"3\"){\n      //https://collections.thulb.uni-jena.de/api/v1/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND place_extended_search:\"Jena\"\n      var req_place = API_URL+ '/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND objectType:\"cbu\" AND place_extended_search:'+title;\n      return axios.get(req_place, {headers:authHeader}).then((response)=>{\n        \n          const data = response.data.response.docs; //docs is a list\n          const resp_in_list= getResultsList(data);\n          return resp_in_list;\n      });    \n    }\n};\n\n/*\n- Eine Gemarkung hat eine Sammlung von untergeordneten Flurnamen als children\n- Es gibt eine Liste der children der Gemarkung\n- Für jedes Element (flurname) wird ein GET-Request mit ID gesendet\n- Nur einige Merkmale wurden gespeichert\n*/\n\nconst getChilden= async (childList)=>{\n  //console.log(\"RUFEN CHILDREN\");\n  var childInfos=[];\n  /*\n  var childImgs=[];\n  for(var i in childList.slice(0,15)){\n    var childID = childList[i].$[\"xlink:title\"];\n    var imgReq = API_URL+'/search?wt=json&q=+cbuUnitTypes.actual:(33.0 33.1) AND returnId:'+childID;\n    await axios.get(imgReq,{headers:authHeader}).then(function (response){\n      var data = response.data.response.docs;\n\n    }\n  };\n*/\n  for(var i in childList.slice(0,5)){\n      var childID = childList[i].$[\"xlink:title\"];\n      var childReq = API_URL+'/objects/'+childID;\n      var childRes = {};\n      //get Images\n\n      await axios.get(childReq, {headers:authHeader}).then(function (response) {\n        var xml2js = require('react-native-xml2js');\n        var parser = new xml2js.Parser();\n        var dataJS='';\n        parser.parseString(response.data, function (err, detailJSON) {\n            dataJS = detailJSON.mycoreobject;\n            //console.log(\"content\");\n            //console.log(content);\n            //dataJS = content;\n          });\n          \n        var content={\n          title:' ',\n          area:' ',\n          evidence:' ',\n          note:' ',\n          parent:' '\n        };\n        \n          try{\n            //metadata[0][\"def.title\"][0].title[0]._\n            var title = dataJS.metadata[0][\"def.title\"][0].title[0]._;\n            content.title=title;\n          }catch{}\n        \n          try{\n            var area = dataJS.metadata[0][\"def.area\"][0].area[0]._;\n            content.area=area;\n          }catch{}\n          try{\n            var evidence = dataJS.metadata[0][\"def.evidence\"][0].evidence[0]._;\n            content.evidence=evidence;\n          }catch{}\n          try{\n            var note = dataJS.metadata[0][\"def.note\"][0].note[0]._;\n            content.note=note;\n          }catch{}\n        \n          try{\n            var parent = dataJS.structure[0].parents[0].parent[0].$[\"xlink:href\"];\n            content.parent=parent;\n          }catch{}\n          //return resJ;\n          //console.log('content');\n          //console.log(content);\n          childRes = content;\n          //console.log('chilRes in function');\n          //console.log(childRes);\n          \n        });\n      \n        console.log(\"children\");\n          console.log(childRes);\n          childInfos.push(childRes);\n      }\n      \n  return childInfos\n}\n\n/*\nresponse von einer Gemarkung beinhaltet mehrere children\ninformation von children wird mit der funktion getChildren gefunden und gespeichert\n*/\nconst contentDetailGemarkung= async (dataJS)=>{\n  console.log(\"JSONJSON\");\n  console.log(dataJS);\n  var content={\n      'title':dataJS.metadata[0][\"def.title\"][0].title[0][\"_\"],\n      //structure[0].derobjects[0].derobject[0].maindoc[0]\n      //'img':dataJS.structure[0].derobjects[0].derobject[0].maindoc[0],\n     'img':[],\n      'children': []\n  }\n  \n  try{\n    content.img = dataJS.structure[0].derobjects[0].derobject//[0].maindoc[0]\n  }\n  catch{}\n  console.log(\"IMAGE\");\n  console.log(content.img);\n  var childINfos = null;\n \n \n  await getChilden(dataJS.structure[0].children[0].child).then(function (result){\n    console.log(result);\n    childINfos = result;\n  });\n  \n  content.children = childINfos;\n\n  var result = []\n  result.push(childINfos);\n  return result;\n};\n\n/*\nInformationen eines Flurnamen wird gefiltert und gespeichert\n\n*/\nconst contentDetailFlurname=(dataJS)=>{\n\n  //console.log(dataJS);\n  //console.log(\"SERVER RESPONSE\");\n  \n  const details=[[]];\n  const content={\n    title:' ',\n    area:' ',\n    evidence:' ',\n    note:' ',\n    parent:' ',\n    img:[]\n  };\n  \n  try{\n    //metadata[0][\"def.title\"][0].title[0]._\n    var title = dataJS.metadata[0][\"def.title\"][0].title[0]._;\n    content.title=title;\n  }catch{\n\n  }\n\n  try{\n    var area = dataJS.metadata[0][\"def.area\"][0].area[0]._;\n    content.area=area;\n  }catch{\n\n  }\n\n  try{\n    var evidence = dataJS.metadata[0][\"def.evidence\"][0].evidence[0]._;\n    content.evidence=evidence;\n  }catch{\n\n  }\n\n  try{\n    var note = dataJS.metadata[0][\"def.note\"][0].note[0]._;\n    content.note=note;\n  }catch{\n\n  }\n\n  try{\n    var parent = dataJS.structure[0].parents[0].parent[0].$[\"xlink:href\"];\n    content.parent=parent;\n  }catch{\n\n  }\n\n  try{\n    content.img = dataJS.structure[0].derobjects[0].derobject//[0].maindoc[0]\n  }\n  catch{}\n  console.log(\"IMAGE\");\n  console.log(content.img);\n\n  details[0].push(content);\n  return details;\n};\n\n\nconst getInfoDetails = (objectID) => {\n  var req = API_URL+'/objects/'+objectID;\n  return axios.get(req, {headers:authHeader}).then((response)=>{\n        \n        var xml2js = require('react-native-xml2js');\n        var parser = new xml2js.Parser();\n        var dataJS='';\n        parser.parseString(response.data, function (err, detailJSON) {\n            dataJS = detailJSON.mycoreobject;\n        });\n        //console.log(\"ALL KEYS\");\n        //console.log(dataJS);\n        //console.log(Object.keys(dataJS.structure));\n        //console.log(dataJS.structure['0']);\n        \n        var keys = Object.keys(dataJS.structure['0']);\n\n        if(keys.includes('children')){\n            var contentG = contentDetailGemarkung(dataJS);\n            //console.log(\"RUECKWERTE\");\n            //console.log(contentG);\n            return contentG\n        }\n        else{\n          //Flurname\n            \n            var contentF = contentDetailFlurname(dataJS);\n            return contentF\n        }\n        //console.log(dataJS);\n        //var content = contentDetails(dataJS)\n      \n  });\n};\n\nexport default {\n  searchInfoQuery,\n  getInfoDetails\n};"]},"metadata":{},"sourceType":"module"}